:toc: macro
:toc-title: Tabla de Contenidos
:toclevels: 3

# https://github.com/wren-lang/wren[_Wren]_ Adventures

En este pequeño documento se detallarán lo básico del lenguaje de programación http://wren.io[Wren]. 

Escrito por https://ninjas.cl[Camilo Castro] y https://github.com/ninjascl/wren-adventures/graphs/contributors[colaboradores]. Para https://ninjas.cl[Ninjas.cl].

Esta obra está bajo una http://creativecommons.org/licenses/by-nc-sa/4.0/[Licencia Creative Commons Atribución-No-Comercial-Compartir-Igual 4.0 Internacional]

http://creativecommons.org/licenses/by-nc-sa/4.0/[image:https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png[Licencia Creative Commons]]

toc::[]

## Pequeña Historia de https://github.com/wren-lang/wren[_Wren]_

https://github.com/wren-lang/wren[_Wren]_ es un lenguaje de programación https://es.wikipedia.org/wiki/Programaci%C3%B3n_orientada_a_objetos[orientado a objetos] creado por http://journal.stuffwithstuff.com/[Bob Nystrom], un ex desarrollador de videojuegos y creador de otros lenguajes de programación como https://github.com/munificent/vigil[Vigil], http://finch.stuffwithstuff.com/[Finch] y http://magpie-lang.org/[Magpie]. Ha escrito dos libros: http://gameprogrammingpatterns.com/[Game Programming Patterns] y http://craftinginterpreters.com/[Crafting Interpreters]. 

El primer _commit_ de _Wren_ fue escrito el https://github.com/wren-lang/wren/tree/2f6a6889f1b4a1ba86aeb169e7398704b1ee04c0[22 de Octubre del 2013] y su versión más reciente es la _0.3_. Actualmente _Bob Nystrom_ pasó a ser colaborador y la evolución del lenguaje fue asignada a https://github.com/underscorediscovery[_discovery] (creador del https://luxeengine.com[game engine Luxe]).

_Wren_ fue creado como una alternativa a _Lua_ y otros https://en.wikipedia.org/wiki/Scripting_language[lenguajes de scripting] para personas que estuvieran más familiarizadas con lenguajes orientados a objetos como _Java_, _C#_, o _C++_. Su principal foco es la simpleza.

La página oficial de Wren es http://wren.io[Wren.io].

### ¿Qué es un _Wren_?

_Wren_ es una https://es.wikipedia.org/wiki/Troglodytidae[tipo de ave pequeña] perteneciente a la familia de los troglodítidos. En Chile tenemos al https://www.avesdechile.cl/074.htm[Chercán o Chochin Criollo].

image:https://user-images.githubusercontent.com/292738/77261969-2240d580-6c71-11ea-93d0-4341e82c2f92.png[Chochin Criollo - Fotografía por Juan Tassara B.]

> Fotografía por Juan Tassara B en https://www.avesdechile.cl.


## ¿Cómo usar Wren?

_Wren_ es un lenguaje interpretado, lo que significa que no requiere de compilación. Basta simplemente tener un intérprete para ejecutar los algoritmos. Hay varias alternativas.

1. https://github.com/wren-lang/wren[Compilar tu propio intérprete de _Wren_]. Esta es la opción para valientes.

2. https://github.com/wren-lang/wren-cli/releases[Utiliza _Wren CLI_] para ejecutar archivos _*.wren_.

3. Utiliza un engine de juegos como https://domeengine.com/[_Dome_], https://tic.computer[_TIC 80_] o https://luxeengine.com/alpha/[_Luxe_] que traen _Wren_ listo para llegar y utilizar.

4. Utiliza http://ppvk.github.io/wren-nest/[_Wren Nest_] para probar el lenguaje en tu navegador. (Puede que no tenga las últimas novedades).

Una vez que tengas tu intérprete instalado puedes ejecutar por ejemplo`./wren main.wren` para ver el resultado de tu script.

### https://github.com/wren-lang/wren-cli[Wren CLI]

La terminal de _Wren_ llamada _Wren CLI_ (https://es.wikipedia.org/wiki/Interfaz_de_l%C3%ADnea_de_comandos[Interfaz de línea de comandos]) permite dos modos de operación. El primero es el modo https://es.wikipedia.org/wiki/REPL[_REPL_] (Bucle Lectura-Evaluación-Impresión) el cual nos permite evaluar las instrucciones una a una. El segundo modo es el intérprete que permite ejecutar scripts _Wren_.

Si ejecutamos simplemente el comando `./wren` entraremos al modo _REPL_. Donde se nos mostrará un simpático pajarito y la versión de _Wren_ instalada.

image:https://user-images.githubusercontent.com/292738/77837383-22444800-713f-11ea-8db4-3f404faabc10.png[Wren CLI]

#### Operaciones Matemáticas

Podremos ejecutar operaciones matemáticas como `5 * 5`.

image:https://user-images.githubusercontent.com/292738/77837948-7ce0a280-7145-11ea-8b43-3f91f7491b35.png[5 * 5]

#### System.print()

O También mostrar un mensaje utilizando `System.print()`.

image:https://user-images.githubusercontent.com/292738/77837982-d517a480-7145-11ea-86f4-7a24e5ecc628.png[System.print()]

¿Por qué aparece la palabra `Plop!` dos veces?. Simplemente por que la primera vez es el resultado de la operación `System.print()` (mostrar un valor), mientras que la segunda vez está mostrando el valor retornado por `System.print()`, el cual es el mismo texto.

#### Errores

Si cometemos algún error _Wren CLI_ nos avisará con un bonito mensaje.

image:https://user-images.githubusercontent.com/292738/77838174-c4682e00-7147-11ea-9e82-ffd2dc4dd1f9.png[Error]

#### Ejecución de Archivos

Cuando necesitamos algo mucho más avanzado podemos utilizar archivos que finalicen con la extensión _*.wren_. El nombre más común es _main.wren_, aunque puedes llamarlo con cualquier nombre. Para ejecutar un archivo específico simplemente se debe utilizar `./wren <archivo.wren>`.

1. Creamos un nuevo archivo llamado `main.wren`.
2. Escribimos nuestro código (En este caso `System.print("Plop!")`) y guardamos.
3. Finalmente Ejecutamos `./wren main.wren`.

Deberíamos ver un resultado similar a este:

image:https://user-images.githubusercontent.com/292738/77839010-7c4d0980-714f-11ea-90df-4330a821d207.png[Plop!]

Notar como solamente aparece una vez "Plop!", ya que no estamos en modalidad _REPL_.

#### Códigos de Salida (Exit Code)

Cada vez que un programa termina su ejecución devuelve un código numérico para indicar si terminó exitosamente o tuvo un algún tipo de error mientras se ejecutaba.

La convención tradicional es considerar el código cero (0) como éxito y cualquier otro número como error. No hay un estándar definido para la asignación de números de error. _Wren_ se basa levemente en los códigos utilizados por el sistema operativo https://github.com/openbsd/src/blob/master/include/sysexits.h[_BSD_].

Actualmente no puedes elegir el código de error. _Wren_ automáticamente asignará el código que mejor se ajuste a la situación. Por ejemplo si utilizar la instrucción para terminar la ejecución del programa `Fiber.abort("Mensaje de Error")` el código asignado sera de 70 (error interno del software).

La siguiente es una tabla con los códigos de BSD más algunos otros adicionales.


```
0 - Fin del programa exitoso
1 - Error desconocido
2 - (grep) Uso incorrecto del comando | (bash) Error de entrada/salida
64 - Uso incorrecto del comando
65 - Error de formato de datos
66 - Sin acceso a la entrada
67 - Dirección desconocida
68 - Nombre de dominio (host name) desconocido
69 - Servicio no disponible
70 - Error interno del software
71 - Error de sistema
72 - Archivo crítico del sistema no encontrado
73 - Imposible de crear archivo de salida
74 - Error de entrada/salida
75 - Falla temporal
76 - Error remoto en protocolo
77 - Permiso denegado
78 - Error de configuración
126 - Comando encontrado, pero no es ejecutable
127 - Comando no encontrado
128 - Código de salida no válido
128   Error fatal terminado por kill -9 
140 - Comando terminado por Ctrl-C
141 - Comando terminado por Ctrl-D
255 - Código de salida fuera de rango
```

Puedes verificar el código numérico de salida utilizando el siguiente comando (bash)

`./wren main.wren | echo "Exit code ${PIPESTATUS[0]}"`

image:https://user-images.githubusercontent.com/292738/77839414-d9968a00-7152-11ea-9bd3-b42ff06a4d1a.png[Exit Code 0]

## Nociones Básicas

### Saltos de línea

_Wren_ utiliza los saltos de línea (`\n`), por lo que no es necesario utilizar el punto y coma (`;`) para separar instrucciones. Sin embargo omite los saltos de línea si la instrucción espera más información para ser válida.

#### Ejemplo: Lista de elementos

```js
var animales = [
  "perro",
  "gato",
  "condor",
  "huemul"
]
```

#### Ejemplo: Parámetros de un método

```js
 MiClase.metodo(
       parametro1,
       parametro2,
       parametro3
 )
```

#### Ejemplo: Generar un número al azar del 0 al 9

Al considerar los saltos de línea significativos, 
provoca un comportamiento inusual al momento de llamar métodos.

Instrucción en una sola línea.

```js
Random.new().int(10)
```

Esto no es válido en _Wren_ (Pero si es válido en la mayoría de los lenguajes de programación).

```js
Random
.new()
.int(10)
```

Para ser válido necesitamos poner un punto al final de la línea.

```js
Random.
new().
int(10)
```

Este comportamiento inusual espera ser reparado en la versión `0.4`.

#### Ejemplo: *Error*

La siguiente línea arroja error debido a que no tiene un salto de línea o una operación.

```js
Random.new().int(10) Random.new().int(10)
```

### Palabras Reservadas

_Wren_ es un lenguaje simple y pequeño. Sus palabras reservadas son las siguientes:

```js
break class construct else false for foreign if import 
in is null return static super this true var while
```

#### Caracteres Significativos

- Caracteres comunes (`+ - * / % < > = ! ( ) [ ] | . " { } , & ^ ? : ~ _`)
- Retorno de carro (`\n`)

### Comentarios

Los comentarios utilizan la misma sintaxis que el https://es.wikipedia.org/wiki/C_(lenguaje_de_programaci%C3%B3n)[`Lenguaje de Programación C`].

Los símbolos son los siguientes: `/* */` (multi línea) y `//` (línea única).

```

// Comentario de una sola línea

/*
Este comentario 
tiene múltiples
líneas
*/
```

Se pueden anidar los comentarios. útil para comentar código que ya tenga comentarios.

```
/*
Este comentario 
tiene múltiples
líneas.
  /* También puedes incluir comentarios, 
  dentro de comentarios multi línea. 
  */
*/
```

#### Tip: Comentarios Tijera

Puedes combinar los comentarios de una sola línea con los de múltiples líneas para
comentar/descomentar rápidamente secciones de código. Se llaman comentarios tijera
por que pueden "cortar" un código para no ser ejecutado.

```js
// /*
   codigo()
// */
```

Al eliminar el comentario de la primera línea, el código será comentado. De esta forma rápidamente
puedes activar o desactivar secciones de código.

```js
/*
   codigo()
// */
```

Puede aún ser más simplificado de esta forma

```js
//*
   codigo()
// */
```

Si se elimina el primer `/` el código será comentado. Por lo que se ahorra un par de movimientos al realizar el comentario.

```js
/*
   codigo()
// */
```
#### Tip: Comentarios de parámetros

En _Wren_ no es posible llamar a los parámetros por su nombre. Por lo que si utilizas una función
con algunos parámetros, puede ser útil comentarlos.

```js
circulo(/* x */ 10, /* y */ 20, /* radio */ 10)
```

### Identificadores

Similar al _Lenguaje C_, para los indentificadores (nombres de variables, clases, metodos, funciones) se pueden utilizar los caracteres de la http://www.asciitable.com/[lista `ascii`] y comenzar con un caracter alfabético o guión bajo. Los identificadores en _Wren_ diferencian entre mayúsculas y minúsculas. Solo se permiten letras (`A - Z`, `a - z`), números (`0 - 9`) y guión bajo (`_`). No se permiten espacios o comenzar con un número.

#### Ejemplo de Identificadores válidos

```js
hola 
camelCase 
PascalCase 
_under_score 
abc123 
TODAS_MAYUSCULAS
```

#### Ejemplo de Identificadores no válidos

```
13hola 
mi-variable
$miVariable 
mi variable
ñandú
👨miMetodo
Mi👩clase
```

#### Unicode

No están permitidos caracteres https://es.wikipedia.org/wiki/UTF-8[UTF-8] como la `Ñ` o los emojis en los identificadores. Sin embargo las `Strings` las soportan en su contenido sin problemas. Hay lenguajes como https://swift.org/[_Swift_] o https://www.emojicode.org/[Emoji Code] que si soportan identificadores con emojis, aunque la utilidad de esta práctica es debatible.

Ejemplo de EmojiCode

```
🏁 🍇
  😀 🔤Hello World!🔤❗️
🍉
```

#### Identificadores con Guión Bajo

Un caso especial es para los identificadores con guión bajo como `_color` (un guión bajo al principio) y `__sabor` (dos guiones bajos al principio). Con un guión bajo indica que es una propiedad de instancia, mientras que con dos guiones bajos indican que es una propiedad de clase. Más detalles en la sección de Clases.

### http://wren.io/modules/core/string.html:[Strings]

Las cadenas de caracteres son delimitadas por las comillas dobles (`"`). Pueden ser de una sola línea o multi línea. En el caso de ser multi línea, estas conservarán todos los caracteres de espacio y salto de línea contenidos en el _string_. El caracter de comilla simple (`'`) no es significativo para _Wren_.

Las strings pueden contener caracteres unicode en http://utf8everywhere.org/[UTF-8], como también caracteres no válidos para _UTF-8_. 

Además son inmutables. El string *"porotos"* no podrá ser modificado (cambiando sus caracteres) luego de su creación.

Un string puede contener los siguientes valores:

- Una cadena de texto compuesto por una secuencia de puntos de código textuales (textual code point).
- Una cadena iterable compuesta por una secuencia de puntos de código numérico (numeric code point).
- Un arreglo simple de bytes indexeables.


#### String de una línea

```js
"Solo es necesario comillas dobles"
```

#### String multi línea

_Wren_ permite string multi líneas utilizando el mismo caracter de comillas dobles (`"`) de las strings de una sola línea. 

```js
"
 Todo esto es una string multi línea
 Wren esperará hasta que aparezca 
 la siguiente comilla doble.
 Los strings multi línea en Wren guardan tanto espacios como saltos de línea en su interior.
 (no son omitidos).
"
```

#### Contando el largo del string

Si utilizamos la propiedad `count` podremos obtener el largo de un string.

Por ejemplo `"hola".count` devolverá `4`. Hay que tener cuidado con los caracteres unicode (emojis), ya que el largo dependerá de lo que se esté contando. _Wren_ cuenta los puntos de código (code point) unicode, por que todos los strings están bajo _UTF-8_ (similar al comportamiento de https://www.ruby-lang.org/en/[_Ruby_] y https://www.python.org/[_Python 3_]).

```js

System.print("a".count) // Retorna 1.
System.print("a".bytes.count) // Retorna 1 (Parte de la tabla ASCII original).

System.print("ñ".count) // Retorna 1.
System.print("ñ".bytes.count) // Retorna 2.

System.print("👹".count) // Retorna 1.
System.print("👹".bytes.count) // Retorna 4.

System.print("👨‍👩‍👧‍👦".count) // Retorna 7 al contar la unidades de código de Unicode
System.print("👨‍👩‍👧‍👦".bytes.count) // Retorna 25 al contar los bytes UTF-8
```

`System.print("👨‍👩‍👧‍👦".count)` retorna 7 por que se está contando las unidades de código de unicode, es decir, el emoji 👨‍👩‍👧‍👦 está formado por los siguientes caracteres : 👨 + caracter de unión de ancho cero + 👩 + caracter de unión de ancho cero + 👧 + caracter de unión de ancho cero + 👦.

`System.print("👨‍👩‍👧‍👦".bytes.count)` retorna 25 por que está contando los bytes necesarios para almacenar estos caracteres. bytes es una secuencia de caracteres en C, lo que permite utilizar los Strings para almacenar información en binario.

Hay dos formas de contar adicionales que _Wren_ no soporta. La primera es contar por unidades de código _UTF-16_ y la otra es considerar los emojis compuestos como una unidad.

El string "👨‍👩‍👧‍👦" debería ser de largo 11 para la codificación _UTF-16_. Mientras que debería ser de largo 1 si lo consideramos como un caracter singular (lo que percibe el usuario). Según los amigos de http://utf8everywhere.org/[UTF-8 Everywhere] contar de estas formas es poco productivo, ya que lo que importa es realmente los code units (unidades de código) _UTF-8_ que se tiene al escribir un string. Por lo que _Wren_ tiene un comportamiento adecuado. De todas formas ese tipo de conversiones y conteo podría programarse con códigos externos a _Wren_. Más detalles en el https://www.unicode.org/glossary/[Glosario Unicode].

#### Unión e interpolación de strings

Si deseamos unir varios strings o incluir datos dentro de ellos podemos utilizar las siguientes operaciones: `+` y `%()`.

- `"Hola" + "Mundo"`: Crea un nuevo string con la unión de `Hola` y `Mundo`. Entregará `HolaMundo`. Es necesario que ambos objetos sean strings. Por ejemplo si se utiliza `"Hola" + 1` entregará un error similar a `Runtime error: Right operand must be a string.`. Para poder unirlos tendremos que utiliza el método getter `toString` del número. `"Hola" + 1.toString`, retornando `Hola1`. 

El método `toString` es parte de la clase http://wren.io/modules/core/object.html:[`Object`] la cual es la padre de todos los tipos de datos en _Wren_. Tanto números, booleanos, strings y listas son objetos que heredan de esta clase.

- `"Hola %(mundo)"`: Crea un string con la frase `Hola` y el contenido de la variable `mundo`.

La operación `%()` permite incluir cualquier instrucción _Wren_ válida, la cual finalmente ejecutará el método `toString` para ser incluido en la cadena de caracteres. Esto incluso permite tener interpolaciones anidadas, pero eso se vuelve poco legible rápidamente.

```js
System.print("La respuesta es %(20 * 2 + 2).")
```

> La respuesta es 42.


#### Caracteres de Escape

Muchas veces se necesitan escribir caracteres especiales en un string. Por ejemplo si quisieramos escribir `"Hola Mundo"` incluyendo las comillas, tendríamos que escribilo de esta forma `"\"Hola Mundo\""`. Esto incluirá los caracteres de comillas dobles en la frase.

```js
"\0" // byte NUL (Nulo) : 0.
"\"" // Comillas dobles.
"\\" // Barra invertida.
"\%" // Signo porcentaje.
"\a" // Sonido de alarma.
"\b" // Retroceso.
"\f" // Alimentación de formularios.
"\n" // Salto de línea.
"\r" // Retorno de carro.
"\t" // Tab.
"\v" // Tab vertical.
```

Para indicar caracteres especiales podemos utilizar `\u` (unicode para letras disponibles en los idiomas humanos), `\U` (unicode para letras especiales como emoji) y `\x` (bytes sin codificar).

- `System.print("\u0041\u0b83\u00DE")` = AஃÞ
- `System.print("\U0001F64A\U0001F680")` = 🙊🚀
- `System.print("\x48\x69\x2e")` = Hi.

#### Obteniendo Caracteres

